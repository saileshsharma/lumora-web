<!DOCTYPE html>
<html>
<head>
    <title>API Test</title>
    <style>
        body { font-family: Arial; padding: 20px; }
        button { margin: 10px; padding: 10px 20px; }
        #output { margin-top: 20px; padding: 15px; background: #f0f0f0; border-radius: 5px; }
        .error { color: red; }
        .success { color: green; }
    </style>
</head>
<body>
    <h1>API Connection Test</h1>

    <h2>Backend: http://localhost:5001/api</h2>

    <button onclick="testHealth()">Test Health Endpoint</button>
    <button onclick="testRateOutfit()">Test Rate Outfit (with real image)</button>

    <div id="output"></div>

    <script>
        const API_BASE = 'http://localhost:5001/api';
        const output = document.getElementById('output');

        function log(message, isError = false) {
            const div = document.createElement('div');
            div.className = isError ? 'error' : 'success';
            div.textContent = message;
            output.appendChild(div);
        }

        async function testHealth() {
            output.innerHTML = '<p>Testing health endpoint...</p>';
            try {
                const response = await fetch(`${API_BASE}/health`);
                const data = await response.json();
                log(`✓ Health check passed: ${JSON.stringify(data)}`);
            } catch (error) {
                log(`✗ Health check failed: ${error.message}`, true);
            }
        }

        async function testRateOutfit() {
            output.innerHTML = '<p>Creating test image...</p>';

            // Create a simple red square as test image
            const canvas = document.createElement('canvas');
            canvas.width = 100;
            canvas.height = 100;
            const ctx = canvas.getContext('2d');
            ctx.fillStyle = 'red';
            ctx.fillRect(0, 0, 100, 100);
            const imageData = canvas.toDataURL('image/png');

            log(`✓ Created test image: ${imageData.substring(0, 50)}...`);
            log('Sending POST request to /api/rate-outfit...');

            try {
                const response = await fetch(`${API_BASE}/rate-outfit`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json',
                    },
                    body: JSON.stringify({
                        image: imageData,
                        occasion: 'Casual',
                        budget: 'Under $50'
                    })
                });

                log(`✓ Response status: ${response.status} ${response.statusText}`);

                const data = await response.json();
                log(`✓ Response data: ${JSON.stringify(data, null, 2)}`);

                if (data.success) {
                    log(`✓✓ Rate outfit SUCCESS!`, false);
                } else {
                    log(`Response indicates error: ${data.error}`, true);
                }
            } catch (error) {
                log(`✗ Request failed: ${error.message}`, true);
                console.error('Full error:', error);
            }
        }
    </script>
</body>
</html>
